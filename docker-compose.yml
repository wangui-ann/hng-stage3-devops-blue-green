nginx:
  image: nginx:stable-alpine
  container_name: nginx
  ports:
    - "8080:80"
  volumes:
    - ./nginx/nginx.conf.template:/etc/nginx/nginx.conf.template:ro
  environment:
    - ACTIVE_POOL=${ACTIVE_POOL}
  entrypoint:
    - /bin/sh
    - -c
    - >
      apk add --no-cache gettext &&
      export ACTIVE_POOL=${ACTIVE_POOL} &&
      envsubst < /etc/nginx/nginx.conf.template > /etc/nginx/nginx.conf &&
      nginx -g 'daemon off;'
  depends_on:
    blue_app:
      condition: service_started
    green_app:
      condition: service_started
